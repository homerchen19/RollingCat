<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
	<title>Rolling Cat</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">
	const innerWidth = window.innerWidth;
	const innerHeight = window.innerHeight;
	const gameRatio = innerWidth / innerHeight;
	const scaleWidth = innerWidth / 1920;
	const scaleHeight = innerHeight / 1080;
	var game = new Phaser.Game(innerWidth, innerHeight, Phaser.AUTO, '', { preload: preload, create: create, update: update });
	var score = 0;
	var stones, stone_1 , stone_2;
  var stone_v = -200;
  var redbeans,redbean;
  var redbean_v = -200;
	var randomXPosition = game.rnd.integerInRange(100, innerWidth);
  //console.log(innerWidth);
  //console.log(innerHeight);
  function hitstone(cat,stone){
    cat.kill();
    game.paused = true;
  }
  function hitbound(bound,obj){
     obj.kill();
  }
	function collectBeans(cat, redbean){
		redbean.kill();
		score = score + 10;
		scoreText.text = 'Score:'+score;
	}
  function createElement(num) {
    for(var i = 0 ; i < num ; i++){
      var x = game.rnd.integerInRange(1,3);
      if( x ==1){
        console.log('Redbean');
        redbean = redbeans.create(innerWidth+(i+1)*game.rnd.integerInRange(redbean.width,innerWidth),game.rnd.integerInRange(0,innerHeight-redbean.height),'redbean');
		    redbean.scale.setTo(scaleWidth, scaleHeight);
        redbean.body.velocity.x = redbean_v;
      }
      else if(x==2){
         stone_1 = stones.create(innerWidth+(i+1)*game.rnd.integerInRange(stone_1.width,innerWidth),innerHeight-stone_1.height,'stone_1'); 
         stone_1.scale.setTo(scaleWidth,scaleHeight);
         stone_1.body.velocity.x = stone_v;
         console.log('Stone_1');
      }
      else{
         stone_2 = stones.create(innerWidth+(i+1)*game.rnd.integerInRange(stone_2.width,innerWidth),innerHeight-stone_2.height,'stone_2'); 
         stone_2.scale.setTo(scaleWidth,scaleHeight);
         stone_2.body.velocity.x = stone_v;
         console.log('Stone_2'+stone_2.height);
      }
    }
}
	function preload() {
		game.load.image('background', 'assets/2.jpg');
		game.load.image('stone_2', 'assets/4.png');
		game.load.image('stone_1', 'assets/5.png');
		game.load.image('cat', 'assets/1.gif');
		game.load.image('redbean', 'assets/3.png');
	}

	function create() {
		// background
		game.physics.startSystem(Phaser.Physics.ARCADE);
		background = game.add.tileSprite(0, 0,1920,1080, 'background');
    background.scale.setTo(scaleWidth,scaleHeight);
    bound = game.add.sprite(-innerWidth,0,'background');
    bound.scale.setTo(scaleWidth,scaleHeight);
    game.physics.arcade.enable(bound);
		// stones
		stones = game.add.group();
		stones.enableBody = true;
    
		var stone1Height = game.cache.getImage("stone_1").height;
		var stone1Width = game.cache.getImage("stone_1").width;
		var stone2Height = game.cache.getImage("stone_2").height;
		var stone2Width = game.cache.getImage("stone_2").width;

		//stone_1
		stone_1 = stones.create(randomXPosition , game.world.height - stone1Height * scaleHeight, 'stone_1');
		stone_1.scale.setTo(scaleWidth, scaleHeight); //重設大小
    stone_1.body.velocity.x = stone_v;
		//stone.body.immovable = true;

		//stone_2
		stone_2 = stones.create(randomXPosition +  stone2Width, game.world.height - stone2Height * scaleHeight , 'stone_2');
		stone_2.scale.setTo(scaleWidth, scaleHeight);
	  stone_2.body.velocity.x = stone_v;
		//stone.body.immovable = true;
		// cat
		cat = game.add.sprite(0, game.world.height - 500, 'cat');
		cat.scale.setTo(scaleWidth, scaleHeight);
		cat.anchor.setTo(0.5, 0.5);
		game.physics.arcade.enable(cat);
		cat.body.bounce.y = 0.4;
		cat.body.gravity.y = 800;
		cat.body.collideWorldBounds = true;

		/*cat.animations.add('left',[0,1,2,3],10,true);
		cat.animations.add('right',[5,6,7,8],10,true);
	    */

		// scoreText
		scoreText = game.add.text(16, 16, 'score:0', { fontSize :'32px', fill :'#000' } );

		redbeans = game.add.group();
		redbeans.enableBody = true;
    game.physics.arcade.enable(redbeans);
		for (var i = 0 ; i < 2 ; i++){
		   redbean = redbeans.create((i + 1) *2800, 0, 'redbean');
		   redbean.scale.setTo(scaleWidth, scaleHeight);
       redbean.body.velocity.x = -1000;
		}
    console.log(redbeans.children);
	}

	function update() {
		//game.physics.arcade.collide(cat, stones);
	  game.physics.arcade.overlap(cat, redbeans, collectBeans, null, this);
	  game.physics.arcade.overlap(cat, stones, hitstone, null, this);
    game.physics.arcade.overlap(bound,redbeans,hitbound,null,this);
    game.physics.arcade.overlap(bound,stones,hitbound,null,this);
	  background.tilePosition.x += -50;
    cat.body.velocity.x = 0;
		cat.angle += 10; //旋轉
    if(redbeans.total==0&&stones.total==0){
       createElement(5);
    }
	  cursors = game.input.keyboard.createCursorKeys();
		if(cursors.left.isDown){
		  cat.body.velocity.x = -150;
		  //player.animations.play('left');
	    }
		else if(cursors.right.isDown){
		  cat.body.velocity.x = 150;
		  //player.animations.play('right');
		}
	    else {
		  cat.animations.stop();
	      //player.frame = 4;
	    }
		if(cursors.up.isDown ){
		  cat.body.velocity.y = -350;
		}
	}

</script>

</body>
</html>
